#!/usr/bin/env ruby
# -*-ruby-*-

# Takes 1 command line parameter: a full path to a plugin.
#
# Reads stdin for a HTML, parses it and prints the result to stdout in
# JSON format. If '-vv' command line parameters were given, output will
# be in 'key: value' pairs and <em>not</em> in JSON.

require_relative '../lib/bwkfanboy/parser'

$conf = {
  banner: "Usage: #{File.basename($0)} [options] /path/to/my/plugin.rb < html"
}

Bwkfanboy::Utils.cl_parse(ARGV, $conf[:banner], nil, true)

if ARGV.size == 0 then
  abort($conf[:banner])
else
  Bwkfanboy::Utils.plugin_load(ARGV[0], Bwkfanboy::Meta::PLUGIN_CLASS)
end

opt = Bwkfanboy::Utils.plugin_opts(ARGV)
pn = Page.new(opt)
pn.check()
pn.parse()

if Bwkfanboy::Utils.cfg[:verbose] >= 2 then
  pn.dump()
else
  puts pn.to_json()
end
